<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>의류수거함 어디있지?</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>

    <style>
        #map {
            width: 70%;
            height: 500px;
            margin: auto;
        }

        /* InfoWindow의 글자색 수정 */
        .iw_inner {
            color: black;
        }
    </style>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=2zcj0zqnez"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body class="is-preload">
    <div class="container">
        <section class="section" id="section-3">
            <h1>의류수거함2</h1>

            <!-- 구 선택 목록 추가 -->
            

            <div id="map"></div>

			<label for="selectGu">구 선택:</label>
            <select id="selectGu">
                <option value="data_dongjak.csv">동작구</option>
                <option value="data_Eunpyeong.csv">은평구</option>
                <!-- 다른 구들도 추가 -->
            </select>

            <code id="snippet" class="snippet"></code>
        </section>
    </div>

    <script>
        var mapOptions = {
            center: new naver.maps.LatLng(37.5665, 126.9780),
            zoom: 10
        };

        var map = new naver.maps.Map('map', mapOptions);

        // 초기에 강남구의 데이터를 로드
        loadData('data_dongjak.csv');

        // 구 선택 목록에 이벤트 리스너 추가
        document.getElementById('selectGu').addEventListener('change', function () {
            var selectedFile = this.value;
            loadData(selectedFile);
        });

        function loadData(csvFile) {
            // 현재 지도에 표시된 마커들 제거
            map.markers.forEach(function (marker) {
                marker.setMap(null);
            });

            $.ajax({
                url: csvFile,
                dataType: 'text',
                success: function (data) {
                    var lines = data.split('\n');
                    for (var i = 0; i < lines.length; i++) {
                        var lineData = lines[i].split(',');
                    	createMarker(String(lineData[0]), parseFloat(lineData[1]), parseFloat(lineData[2]));
                    }
                }
            });
        }

        function createMarker(labelContent, lat, lng) {
            var markerOptions = {
                position: new naver.maps.LatLng(lat, lng),
                map: map
            };

            var marker = new naver.maps.Marker(markerOptions);

            var contentString = [
                '<div class="iw_inner">',
                '   <h3>마커 정보</h3>',
                '   <p>마커 내용: ' + labelContent + '<br>',
                '       좌표: ' + lat + ', ' + lng + '</p>',
                '</div>'
            ].join('');

            var infowindow = new naver.maps.InfoWindow({
                content: contentString
            });

            naver.maps.Event.addListener(marker, 'click', function (e) {
                if (infowindow.getMap()) {
                    infowindow.close();
                } else {
                    infowindow.open(map, marker);
                }
            });
        }
    </script>
</body>

</html>
